{"version":3,"sources":["/home/runner/workspace/src/app/api/drive/files/rename/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nimport { initDriveService, handleApiError } from '@/lib/api-utils'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const authResult = await initDriveService()\n    if (!authResult.success) {\n      return authResult.response!\n    }\n\n    const { driveService } = authResult\n    const body = await request.json()\n\n    // Handle both single and bulk operations\n    const { fileId, namePrefix, newName, items } = body\n\n    // Determine operation type based on items array or single fileId\n    const fileIds = items && items.length > 0 ? items.map((item: any) => item.id) : [fileId]\n    const isBulkOperation = items && items.length > 1\n\n    if (!fileIds || fileIds.length === 0) {\n      return NextResponse.json({ error: 'File IDs are required' }, { status: 400 })\n    }\n\n    const results = []\n    const errors = []\n\n    for (const id of fileIds) {\n      try {\n        let finalName = newName\n\n        // For bulk operations, use prefix with original name\n        if (isBulkOperation && namePrefix) {\n          const originalItem = items.find((item: any) => item.id === id)\n          finalName = `${namePrefix} ${originalItem?.name || 'Unknown'}`\n        }\n\n        if (!finalName) {\n          errors.push({\n            fileId: id,\n            success: false,\n            error: 'New name is required',\n          })\n          continue\n        }\n\n        const result = await driveService.renameFile(id, finalName)\n        results.push({ fileId: id, success: true, result })\n      } catch (error: any) {\n        errors.push({\n          fileId: id,\n          success: false,\n          error: error.message || 'Rename failed',\n        })\n      }\n    }\n\n    const response = {\n      success: errors.length === 0,\n      processed: results.length,\n      failed: errors.length,\n      type: isBulkOperation ? 'bulk' : 'single',\n      operation: 'rename',\n      results,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n\n    return NextResponse.json(response, {\n      status: errors.length === 0 ? 200 : 207,\n    })\n  } catch (error: any) {\n    return handleApiError(error)\n  }\n}\n"],"names":["POST","request","authResult","initDriveService","success","response","driveService","body","json","fileId","namePrefix","newName","items","fileIds","length","map","item","id","isBulkOperation","NextResponse","error","status","results","errors","finalName","originalItem","find","name","push","result","renameFile","message","processed","failed","type","operation","undefined","handleApiError"],"mappings":";;;;+BAIsBA;;;eAAAA;;;wBAJoB;0BAEO;AAE1C,eAAeA,KAAKC,OAAoB;IAC7C,IAAI;QACF,MAAMC,aAAa,MAAMC,IAAAA,0BAAgB;QACzC,IAAI,CAACD,WAAWE,OAAO,EAAE;YACvB,OAAOF,WAAWG,QAAQ;QAC5B;QAEA,MAAM,EAAEC,YAAY,EAAE,GAAGJ;QACzB,MAAMK,OAAO,MAAMN,QAAQO,IAAI;QAE/B,yCAAyC;QACzC,MAAM,EAAEC,MAAM,EAAEC,UAAU,EAAEC,OAAO,EAAEC,KAAK,EAAE,GAAGL;QAE/C,iEAAiE;QACjE,MAAMM,UAAUD,SAASA,MAAME,MAAM,GAAG,IAAIF,MAAMG,GAAG,CAAC,CAACC,OAAcA,KAAKC,EAAE,IAAI;YAACR;SAAO;QACxF,MAAMS,kBAAkBN,SAASA,MAAME,MAAM,GAAG;QAEhD,IAAI,CAACD,WAAWA,QAAQC,MAAM,KAAK,GAAG;YACpC,OAAOK,oBAAY,CAACX,IAAI,CAAC;gBAAEY,OAAO;YAAwB,GAAG;gBAAEC,QAAQ;YAAI;QAC7E;QAEA,MAAMC,UAAU,EAAE;QAClB,MAAMC,SAAS,EAAE;QAEjB,KAAK,MAAMN,MAAMJ,QAAS;YACxB,IAAI;gBACF,IAAIW,YAAYb;gBAEhB,qDAAqD;gBACrD,IAAIO,mBAAmBR,YAAY;oBACjC,MAAMe,eAAeb,MAAMc,IAAI,CAAC,CAACV,OAAcA,KAAKC,EAAE,KAAKA;oBAC3DO,YAAY,GAAGd,WAAW,CAAC,EAAEe,cAAcE,QAAQ,WAAW;gBAChE;gBAEA,IAAI,CAACH,WAAW;oBACdD,OAAOK,IAAI,CAAC;wBACVnB,QAAQQ;wBACRb,SAAS;wBACTgB,OAAO;oBACT;oBACA;gBACF;gBAEA,MAAMS,SAAS,MAAMvB,aAAawB,UAAU,CAACb,IAAIO;gBACjDF,QAAQM,IAAI,CAAC;oBAAEnB,QAAQQ;oBAAIb,SAAS;oBAAMyB;gBAAO;YACnD,EAAE,OAAOT,OAAY;gBACnBG,OAAOK,IAAI,CAAC;oBACVnB,QAAQQ;oBACRb,SAAS;oBACTgB,OAAOA,MAAMW,OAAO,IAAI;gBAC1B;YACF;QACF;QAEA,MAAM1B,WAAW;YACfD,SAASmB,OAAOT,MAAM,KAAK;YAC3BkB,WAAWV,QAAQR,MAAM;YACzBmB,QAAQV,OAAOT,MAAM;YACrBoB,MAAMhB,kBAAkB,SAAS;YACjCiB,WAAW;YACXb;YACAC,QAAQA,OAAOT,MAAM,GAAG,IAAIS,SAASa;QACvC;QAEA,OAAOjB,oBAAY,CAACX,IAAI,CAACH,UAAU;YACjCgB,QAAQE,OAAOT,MAAM,KAAK,IAAI,MAAM;QACtC;IACF,EAAE,OAAOM,OAAY;QACnB,OAAOiB,IAAAA,wBAAc,EAACjB;IACxB;AACF"}