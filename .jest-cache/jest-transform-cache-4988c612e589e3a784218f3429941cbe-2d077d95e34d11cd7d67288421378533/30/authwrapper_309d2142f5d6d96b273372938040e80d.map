{"version":3,"names":["AuthWrapper","children","fallback","cov_yqkpj3fr6","f","data","session","status","s","_react","useSession","router","_navigation","useRouter","isServerOnline","setIsServerOnline","_react1","useState","hasStoredSession","setHasStoredSession","_usesessionduration","useSessionDuration","useEffect","window","b","nextAuthSession","localStorage","getItem","document","cookie","includes","process","env","NODE_ENV","checkServerStatus","response","fetch","method","cache","signal","AbortSignal","timeout","ok","push","error","_jsxruntime","jsx","className","jsxs","style","width","Fragment"],"sources":["/home/runner/workspace/src/components/auth/auth-wrapper.tsx"],"sourcesContent":["'use client'\n\nimport { useSession } from 'next-auth/react'\nimport { useRouter } from 'next/navigation'\nimport { ReactNode, useEffect, useState } from 'react'\nimport { useSessionDuration } from '@/lib/hooks/use-session-duration'\n\ninterface AuthWrapperProps {\n  children: ReactNode\n  fallback?: ReactNode\n}\n\nexport function AuthWrapper({ children, fallback }: AuthWrapperProps) {\n  const { data: session, status } = useSession()\n  const router = useRouter()\n  const [isServerOnline, setIsServerOnline] = useState(true)\n  const [hasStoredSession, setHasStoredSession] = useState(false)\n\n  // Handle session duration based on remember me preference\n  useSessionDuration()\n\n  // Check if user has stored session data (indicating they were previously logged in)\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const nextAuthSession =\n        localStorage.getItem('next-auth.session-token') ||\n        localStorage.getItem('__Secure-next-auth.session-token') ||\n        document.cookie.includes('next-auth.session-token') ||\n        document.cookie.includes('__Secure-next-auth.session-token')\n      setHasStoredSession(!!nextAuthSession)\n    }\n  }, [])\n\n  // Check server connectivity when status is unauthenticated\n  useEffect(() => {\n    // Don't redirect during tests\n    if (process.env.NODE_ENV === 'test') {\n      return\n    }\n\n    if (status === 'unauthenticated' && hasStoredSession) {\n      const checkServerStatus = async () => {\n        try {\n          const response = await fetch('/api/health', {\n            method: 'HEAD',\n            cache: 'no-cache',\n            signal: AbortSignal.timeout(5000),\n          })\n\n          if (!response.ok) {\n            setIsServerOnline(false)\n            router.push('/server-offline')\n            return\n          }\n\n          setIsServerOnline(true)\n          // If server is online but user is unauthenticated, redirect to login\n          if (!fallback) {\n            router.push('/auth/v1/login')\n          }\n        } catch (error) {\n          setIsServerOnline(false)\n          router.push('/server-offline')\n        }\n      }\n\n      checkServerStatus()\n    } else if (status === 'unauthenticated' && !hasStoredSession && !fallback) {\n      // No stored session and unauthenticated - direct to login\n      router.push('/auth/v1/login')\n    }\n  }, [status, fallback, router, hasStoredSession])\n\n  if (status === 'loading') {\n    return (\n      <div className=\"bg-background flex h-screen items-center justify-center\">\n        <div className=\"mx-auto max-w-sm space-y-4 px-6 text-center\">\n          <div className=\"relative\">\n            <div className=\"border-muted border-t-primary mx-auto h-12 w-12 animate-spin rounded-full border-4\"></div>\n            <div className=\"border-primary/20 absolute inset-0 mx-auto h-12 w-12 animate-pulse rounded-full border-4\"></div>\n          </div>\n          <div className=\"space-y-2\">\n            <p className=\"text-foreground text-lg font-medium\">Authenticating</p>\n            <p className=\"text-muted-foreground text-sm\">Verifying your Google Drive access...</p>\n          </div>\n          <div className=\"bg-muted mx-auto h-1 w-48 overflow-hidden rounded-full\">\n            <div className=\"bg-primary h-full animate-pulse rounded-full\" style={{ width: '60%' }}></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (status === 'unauthenticated') {\n    if (fallback) {\n      return <>{fallback}</>\n    }\n\n    // If we have stored session but are unauthenticated, likely server issue\n    if (hasStoredSession && !isServerOnline) {\n      return (\n        <div className=\"flex h-screen items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"border-primary mx-auto mb-2 h-8 w-8 animate-spin rounded-full border-2 border-t-transparent\"></div>\n            <p>Checking server connection...</p>\n          </div>\n        </div>\n      )\n    }\n\n    // Show access denied message for users without stored session\n    return (\n      <div className=\"flex h-screen items-center justify-center\">\n        <div className=\"text-center\">\n          <p>Access denied. Please sign in.</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (status === 'authenticated' && session) {\n    return <>{children}</>\n  }\n\n  return (\n    <div className=\"flex h-screen items-center justify-center\">\n      <div className=\"border-primary h-8 w-8 animate-spin rounded-full border-2 border-t-transparent\"></div>\n    </div>\n  )\n}\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}